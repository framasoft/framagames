/*
 * Copyright (c) 2011 Emin KURA (http://eminkura.com)
 *
 * Licensed under the MIT (http://eminkura.com/license.html) license.
 */
function GameCanvas(j,k){this.width=j;this.height=k;this.bgColor="#f00";this.canvas=new Raphael(0,0,this.width+100,this.height+100);this.gameArray=[[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[1,1,1,1,1,1,1],[1,1,1,2,1,1,1],[1,1,1,1,1,1,1],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0]];this.deckArray=null;GameCanvas.prototype.init=function(){this.deckArray=[];var b=this.width/14-2,d,e;d=b+20;e=b+20;for(var a=0;a<this.gameArray.length;a++){this.deckArray[a]=[];for(var c=0;c<this.gameArray[a].length;c++)this.deckArray[a][c]=
new Deck(d,e,b,this.gameArray[a][c],a,c,this.bgColor,this.canvas),d+=b*2+5;d=b+20;e+=b*2+5}};GameCanvas.prototype.update=function(){this.deckArray==null&&this.init();for(var b=0;b<this.deckArray.length;b++)for(var d=0;d<this.deckArray[b].length;d++)this.deckArray[b][d].draw()};GameCanvas.prototype.clear=function(){this.canvas.clear()};GameCanvas.prototype.getSelected=function(){for(var b=0;b<this.deckArray.length;b++)for(var d=0;d<this.deckArray[b].length;d++)if(this.deckArray[b][d].isSelected())return this.deckArray[b][d];
return null};GameCanvas.prototype.changeDecks=function(b,d,e,a,c,f){this.gameArray[b][d]=2;this.gameArray[e][a]=2;this.gameArray[c][f]=1;this.deckArray[b][d].setSelected(!1);this.deckArray[e][a].setSelected(!1);this.deckArray[c][f].setSelected(!1);this.deckArray[b][d].setValue(2);this.deckArray[e][a].setValue(2);this.deckArray[c][f].setValue(1);this.deckArray[b][d].draw();this.deckArray[e][a].drawAnimated(this.width+150,this.width+150);this.deckArray[c][f].drawAnimated(this.deckArray[b][d].x,this.deckArray[b][d].y)};
GameCanvas.prototype.onmouseover=function(b,d){for(var e=0;e<this.deckArray.length;e++)for(var a=0;a<this.deckArray[e].length;a++)if(this.deckArray[e][a].collides(b,d))this.deckArray[e][a].onmouseover()};GameCanvas.prototype.onmouseout=function(b,d){for(var e=0;e<this.deckArray.length;e++)for(var a=0;a<this.deckArray[e].length;a++)if(!this.deckArray[e][a].collides(b,d))this.deckArray[e][a].onmouseout()};GameCanvas.prototype.onclick=function(b,d){for(var e=this.getSelected(),a=0;a<this.deckArray.length;a++)for(var c=
0;c<this.deckArray[a].length;c++)if(this.deckArray[a][c].collides(b,d)){if(this.deckArray[a][c].onclick(b,d),this.gameArray[a][c]==2&&e!=null){var f=e.i,g=e.j;if(f==a){if(g==c-2||g==c+2){if(g==c-2){if(this.gameArray[a][c-1]!=1)return}else if(g==c+2&&this.gameArray[a][c+1]!=1)return;var h,i;i=g==c-2?c-1:c+1;h=a;this.changeDecks(f,g,h,i,a,c)}}else if(g==c&&(f==a-2||f==a+2)){if(f==a-2){if(this.gameArray[a-1][c]!=1)return}else if(f==a+2&&this.gameArray[a+1][c]!=1)return;h=f==a-2?a-1:a+1;i=c;this.changeDecks(f,
g,h,i,a,c)}}}else this.deckArray[a][c].setSelected(!1)};GameCanvas.prototype.drawBackground=function(){var b=this.canvas.circle(this.width/2+20,this.height/2+20,this.width/2+15);b.attr("fill",this.bgColor);b.attr("stroke","#000000");b.attr("stroke-linecap","round");b.attr("stroke-width",2)}}
function Deck(j,k,b,d,e,a,c,f){this.canvas=f;this.x=j;this.y=k;this.i=e;this.j=a;this.bgColor=c;this.radius=b;this.value=d;this.deckColor="r#3C93C9-#126294";this.deckColorH="r#C46A6A-#A64444";this.mouseover=this.selected=!1;this.setValue=function(a){this.value=a};this.setSelected=function(a){if(this.value==1&&a!=this.selected)this.selected=a,this.drawSelected()};this.isSelected=function(){return this.selected};this.paintComponent=function(a){this.value==1?this.selected?(a.attr("stroke","#19191A"),
a.attr("stroke-linecap","round"),a.attr("stroke-width",2),a.attr("fill",this.deckColorH)):(a.attr("stroke","#19191A"),a.attr("fill",this.deckColor),a.attr("stroke-linecap","round"),a.attr("stroke-width",2)):this.value==2&&(this.canvas.circle(this.x,this.y,this.radius).attr("fill",this.bgColor),a=this.canvas.circle(this.x,this.y,this.radius),a.attr("stroke","#000000"),a.attr("stroke-linecap","round"),a.attr("stroke-width",1),a.attr("fill","#000000"),a.attr("opacity",0.2))};this.draw=function(){this.value!=
0&&this.paintComponent(this.canvas.circle(this.x,this.y,this.radius))};this.drawSelected=function(){this.value!=0&&this.paintComponent(this.canvas.circle(this.x,this.y,this.radius))};this.drawOver=function(a){if(this.value!=0){var b=this.canvas.circle(this.x,this.y,this.radius);this.paintComponent(b);this.value==1&&(this.selected||(a?b.animate({stroke:"#FFFFFF"},200):b.animate({stroke:"#19191A"},200)))}};this.drawAnimated=function(a,b){var c=null;if(this.value==1)c=this.canvas.circle(a,b,this.radius),
this.paintComponent(c),c.toFront(),c.animate({cx:this.x,cy:this.y},500),c.animate({"50%":{scale:"1.2,1.2"},"100%":{scale:"1,1"}},500);else if(this.value==2){c=this.canvas.circle(this.x,this.y,this.radius);this.paintComponent(c);var d=this.canvas.circle(this.x,this.y,this.radius);d.attr("stroke","#fff");d.attr("fill",this.deckColor);d.animate({scale:0},500,"bounce",function(){d.hide()})}};this.onmouseover=function(){if(!this.mouseover)this.mouseover=!0,this.drawOver(!0)};this.onmouseout=function(){if(this.mouseover)this.mouseover=
!1,this.drawOver(!1)};this.onclick=function(){this.setSelected(!this.selected)};this.collides=function(a,c){if(a>=this.x-b&&a<=this.x+b&&c>=this.y-b&&c<=this.y+b)return!0;return!1}};
